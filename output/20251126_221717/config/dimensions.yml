# !/usr/bin/env yaml
#
# === FILE META OPENING ===
# file: ./trend-analyzer/config/dimensions.yml
# role: configuration
# desc: basic dimensions configuration for skeleton testing
# === FILE META CLOSING ===

# Basic dimensions configuration for skeleton mode
# they start with underscores to indicate they are special sections
_meta:
  descriptor_alias: clc  # clc = claim_line_claims
  norm_alias: m  # m = members

_targets:
  dataset: skeleton_test
  descriptor_table: trend_descriptor_test
  norm_table: trend_norm_test

_years:
  2023:
    member_snapshot: placeholder.member_table_2023
    claim_snapshot: placeholder.claim_table_2023
    months: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]
  2024:
    member_snapshot: placeholder.member_table_2024
    claim_snapshot: placeholder.claim_table_2024
    months: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]

_norm_joins: {}
_descriptor_joins: {}

_filters:
  common:
    - "placeholder_filter = 'skeleton'"
  norm:
    - "test_account = false"
  descriptor:
    - "is_test_claim = false"

dimensions:
  - name: state
    scope: both
    expr: state
    description: "US state where the plan is offered"
    
  - name: year
    scope: both
    expr: "EXTRACT(YEAR FROM {norm_alias}.month)"
    description: "Calendar year of the enrollment/claim"

metrics:
  - name: allowed
    scope: descriptor
    requires: [allowed]
    expr: "SUM(allowed)"
    
  - name: member_months
    scope: norm
    requires: [ra_mm]
    expr: "SUM(ra_mm)"